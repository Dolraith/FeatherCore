/* global global, __dirname */
const fs = require('fs');

class controller{
    constructor(action = null){
        this._body = '';
        if(action === null){
            action = 'index';
        }
        if(action in this && typeof this[action] === 'function'){
            this[action]();
        }
        this.SetHeader('modules/feather_core/default/templates/header.html');
        this.SetFooter('modules/feather_core/default/templates/footer.html');
        
        //TODO: write good composit
        this.badComposit();                        
    }
    
    badComposit(){
        var finalResponse = "";
        
        //header
        finalResponse += this.GetChunk(this.header);
        //includes
        //TODO: actually do includes
        finalResponse += '<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">\n';
        //close head / open body
        finalResponse += '</head>\n<body>';
        //body segment generated by the controller
        finalResponse += global._body;
        //footer
        finalResponse += this.GetChunk(this.footer);
        global._response.send(finalResponse);
    }
    
    SetHeader(headerPath){
        this.header = headerPath;
    }
    SetFooter(footerPath){
        this.footer = footerPath;
    }
    
    GetChunk(path){
        return fs.readFileSync(global.server_root+'/' + path);
    }
}
module.exports = controller;